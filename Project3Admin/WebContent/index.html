<!DOCTYPE html>
<html>

<head>
<meta charset="ISO-8859-1">
<title>Insert title here</title>
<script src="//cdn.bootcss.com/jquery/3.1.1/jquery.min.js"></script>
<link rel="stylesheet"
	href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css"
	integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u"
	crossorigin="anonymous">
<link rel="stylesheet"
	href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap-theme.min.css"
	integrity="sha384-rHyoN1iRsVXV4nD0JutlnGaslCJuC7uwjduW9SVrLvRYooPp2bWYgmgJQIXwl/Sp"
	crossorigin="anonymous">
<script
	src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"
	integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa"
	crossorigin="anonymous"></script>
<link href="css/sticky-footer-navbar.css" rel="stylesheet">
</head>
<style>
.content {
	display: none;
}
</style>
<body>

	<!-- Fixed navbar -->
	<nav class="navbar navbar-default navbar-fixed-top">
		<div class="container">
			<div class="navbar-header">
				<button type="button" class="navbar-toggle collapsed"
					data-toggle="collapse" data-target="#navbar" aria-expanded="false"
					aria-controls="navbar">
					<span class="sr-only">Toggle navigation</span> <span
						class="icon-bar"></span> <span class="icon-bar"></span> <span
						class="icon-bar"></span>
				</button>
				<a class="navbar-brand" href="#">Hi <span id="hiName"></span></a>
			</div>
			<div id="navbar" class="collapse navbar-collapse">
				<ul class="nav navbar-nav navbar-right">
					<li id="home" class="active" data-index="search"><a href="#search">Main</a></li>
					<li id="sett" data-index="setting"><a href="#setting">Setting</a></li>
					<li><a href="admin/logout">Logout</a></li>
				</ul>
			</div>
			<!--/.nav-collapse -->
		</div>
	</nav>

	<!-- Begin page content -->
	<div class="container">
		<!-- Search Section-->
		<section class="content" data-index="search">
			<div class="page-header">
				<h1>Merchants List</h1>
			</div>
			<p class="lead">
				Change status for merchants to
				<code>Accept</code>
				in order to allow them Login.
			</p>
			<div class="row">
				<div id="load" class="progress progress-striped active" style="display:none">
		     		<div id="loadingbar" class="progress-bar" style="width:10%;">
		      			<span class="sr-only">60% Complete</span>
		     		</div>
		    	</div>
		    	    <div class="form-group pull-right">
        <input type="text" class="search form-control" placeholder="Search here">
    </div>
    <span class="counter pull-right"></span>
				<div id="listMerchant"></div>
			</div>
			<!-- edit -->
		</section>
		<section class="content" data-index="setting">
			<div class="page-header">
				<h1>Setting</h1>
			</div>
			<div class="page-header">
			   <form class="form-horizontal" id="changePassword">
			     <span class="col-sm-1"></span><h3>Change Password</h3>
				  <div class="form-group">
				    <label class="col-sm-2 control-label">Username</label>
				    <div class="col-sm-8">
				      <p class="form-control-static" name="editName" id="editName"></p>
				    </div>
				  </div>
				  <div class="form-group">
				    <label for="inputPassword" class="col-sm-2 control-label">Password</label>
				    <div class="col-sm-8">
				      <input type="password" class="form-control" name="editPwd" id="inputPassword" placeholder="Password">
				    </div>
				  </div>
                  <div class="form-group">
				    <span class="col-sm-2 control-label"></span>
				    <div class="col-sm-8">
				      <input class="btn btn-primary btn-block" type="submit" value="Edit"/>
				    </div>
				  </div>
				</form>	
			</div>
            <div class="page-header">
			   <form class="form-horizontal" id="createAdmin">
			     <span class="col-sm-1"></span><h3>Create Admin</h3>
				  <div class="form-group">
				    <label for="loginName" class="col-sm-2 control-label adminName">Username</label>
				    <div class="col-sm-8">
				      <input type="text" class="form-control" name="loginName" id="loginName" placeholder="Username">
				    </div>
				  </div>
				  <div class="form-group">
				    <label for="createPassword" class="col-sm-2 control-label">Password</label>
				    <div class="col-sm-8">
				      <input type="password" class="form-control" name="password" id="inputPassword" placeholder="Password">
				    </div>
				  </div>
				  <div class="form-group">
				    <span class="col-sm-2 control-label"></span>
				    <div class="col-sm-8">
				      <input type="submit" class="btn btn-primary btn-block" value="Create" />
				    </div>
				  </div>
				</form>	
			</div>
            <div class="page-header">
                <span class="col-sm-1"></span><h3>Show All Admin</h3>
                <div class="col-sm-1"></div><div class="col-sm-10" id="adminTable"></div>
            </div>
			<!-- edit -->
		</section>
	</div>

	<!--  footer -->
	<footer class="footer">
		<div class="container">
			<p class="text-muted">Place sticky footer content here.</p>
		</div>
	</footer>
	<script>
	    $(function(){
	    	$("#home a").trigger("click");
			$("#createAdmin").submit(function(e) {
				e.preventDefault();
			   	$.ajax({
			        type:'POST',
			        url:'admin/create',
			        data:{loginName:$("[name=loginName]").val(),password:$("[name=password]").val()}
			    }).done(function(result){
			       	alert("Create admin "+ result.loginName + " successfully!!!");
			       	loadSetting();
			    }); 
			});
			$.get("admin/getName",function(data){
				$("#editName").html(data);
				$("#hiName").html(data);
			});
			$("#changePassword").submit(function(e) {
				e.preventDefault();
			   	$.ajax({
			        type:'POST',
			        url:'admin/edit',
			        data:{loginName:$("[name=editName]").val(),password:$("[name=editPwd]").val()}
			    }).done(function(result){
			       	alert("Edit password successfully!!!");
			       	loadSetting();
			    }); 
			});
            $(".search").keyup(function () {
                var searchTerm = $(".search").val();
                var listItem = $('.results tbody').children('tr');
                var searchSplit = searchTerm.replace(/ /g, "'):containsi('")

                $.extend($.expr[':'], {
                    'containsi': function (elem, i, match, array) {
                        return (elem.textContent || elem.innerText || '').toLowerCase().indexOf((match[3] || "").toLowerCase()) >= 0;
                    }
                });

                $(".results tbody tr").not(":containsi('" + searchSplit + "')").each(function (e) {
                    $(this).attr('visible', 'false');
                    $(this).css('display', 'none');
                });

                $(".results tbody tr:containsi('" + searchSplit + "')").each(function (e) {
                    $(this).attr('visible', 'true');
                    $(this).css('display', '');
                });

                var jobCount = $('.results tbody tr[visible="true"]').length;
                $('.counter').text(jobCount + ' item');

                if (jobCount == '0') {
                    $('.no-result').show();
                } else {
                    $('.no-result').hide();
                }
            });
	    });
		function loadSetting() {
			$("#sett a").trigger("click");
		}
		function getAdminList() {
            $.get("admin/showAll",function(data){
    			var table = "<table class=\"table table-bordered\" style=\"margin-top:20px\"><tr><td>#</td><td>Username</td></tr>";
    			for (var a=0;a<data.length; a++) {
    				var tr = "<tr>";
    				tr+= "<td>"+(a+1)+". </td><td>"+data[a].loginName+"</td></tr>";
    				table += tr;
    		    }
    		    table+="</table>";
    	    	$("#adminTable").html(table);
            });
		}
	    $("#home a").on("click", function() {
		    $("#loadingbar").css("width","10%");
		    $("#listMerchant").hide();
		    $("#load").show();
	        $.ajax({
	            xhr: function() {
	                var xhr = new window.XMLHttpRequest();
	                xhr.addEventListener("progress", function(evt){
	                	if (evt.lengthComputable) {
	                    	var percentComplete = evt.loaded / evt.total;
	                    	 //Do something with download progress
	                     	var value = percentComplete * 100;
	                     	value = value+"%";
	                     	$('#loadingbar').width(value)
	                    }
	            	}, false);
	                return xhr;
	            }, 
	            type: 'GET', 
	            url: "request/merchantList", 
	            complete: function(response, status, xhr) {	          
					var data = JSON.parse(response.responseText)
					var table = "<table class=\"table table-hover table-bordered results\">";
					table+="<thead><tr><th>Name</th><th>Status</th></tr></thead><tbody>";
					for (var a=0;a<data.length; a++) {
						var mid = data[a].id;
						var tr = "<tr>";
						tr+= "<td>"+data[a].merchantName+"</td><td id=\""+mid+"\">";
						//var status = data[a].status;

			            $.get("checkMerchantStatus",{merchantId:mid},function(result){
				            var status = result.status;
				            var tr="";
							if(status==="UnderReview") {
								tr+= "<button onclick=\"updateStatus('"+result.id+"','Accepted')\">Accept</button>";
								tr+= "<button onclick=\"updateStatus('"+result.id+"','Rejected')\">Reject</button>";
							} else if(status==="Accepted") {
								tr+= "<button onclick=\"updateStatus('"+result.id+"','Frozen')\">BlackList</button>";
							} else if (status==="Rejected") {
								tr+= "<button onclick=\"updateStatus('"+result.id+"','Accepted')\">Accept</button>";
							} else if (status==="Frozen") {
								tr+= "<button onclick=\"updateStatus('"+result.id+"','Accepted')\">Remove Blacklist</button>";
							}
							if (status!=="Deleted")
								tr+= "<button onclick=\"deleteStatus('"+result.id+"')\">Delete</button>";
								console.log(tr);
							$("#"+result.id).html(tr);
			            });

						table += tr+"</td></tr>";

				    }
				    table+="</tbody></table>";
				    $("#listMerchant").html(table);
				    $("#load").hide();
				    $("#listMerchant").show();
	            }
	        });
		});
        $(".nav a").on("click", function () {
            $(".nav").find(".active").removeClass("active");
            $(this).parent().addClass("active");
            $('.content').hide();
            var id = $(this).parent().attr("data-index");
            if(id==="setting") {
            	getAdminList();
     		}
            $('section[data-index="' + $(this).parent().attr("data-index") + '"]').show();
        });
        function updateStatus(targetId,targetStatus) {
            $.get("admin/updateStatus",{id:targetId,status:targetStatus},function(data){
            	$("#home a").trigger("click");
            });  
        }
    </script>
</body>

</html>